<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="aka_baka" /><link rel="canonical" href="https://aka-baka.github.io/deck-mining/mining/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Mining to Anki - JP Mining on Steam Deck</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Mining to Anki";
        var mkdocs_page_input_path = "deck-mining/mining.md";
        var mkdocs_page_url = "/deck-mining/mining/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> JP Mining on Steam Deck
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Home</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../">Introduction</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Setup</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../setupIntro/">Setup Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../setupTools/">Tools</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../beforePlaying/">Getting Things Ready Before Playing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../hookSteamGames/">Hooking Steam Games</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../hookLutrisGames/">Hooking Lutris or Other proton Launcher Games</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../hookEmuDeck/">Hooking Linux Games or Emulators</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../OCR/">Using OCR</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Mining to Anki</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#how-to-save-screenshots-to-anki">How to save screenshots to Anki</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#how-to-record-audio-to-anki">How to record audio to Anki</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#adding-keyboard-shortcuts-to-call-the-screenshot-and-record-audio-scripts">Adding keyboard shortcuts to call the screenshot and record audio scripts</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#mapping-the-shortcuts-and-other-actions-to-controller-buttons">Mapping the shortcuts and other actions to controller buttons</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../controller/">Controller Mapping</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../demos/">Demos</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Extras</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tips/">Misc Tips</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../resources/">Resources</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../runWin/">Run Windows</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../acknowledgements/">Acknowledgements</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">JP Mining on Steam Deck</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Setup</li>
      <li class="breadcrumb-item active">Mining to Anki</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="mining">Mining</h1>
<h2 id="how-to-save-screenshots-to-anki">How to save screenshots to Anki</h2>
<p>Save this shell script to your Deck, keep it somewhere you'll remember. 
Calling this script will capture the active window and save it to the latest Anki note, and display a notification (depending on your notification settings, you may not see it when in-game).
With thanks to Xythh whom I got the code snippet from and just made minor edits to work on the Deck.</p>
<details class="note">
<summary>ss_window.sh</summary>
</details>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="ch">#!/bin/sh</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="c1">### capture screnshot with spectacle</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1">#ss_dir=&quot;/home/deck/Pictures/Screenshots/for_anki&quot;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nv">time</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%Y-%m-%d-%H-%M-%S<span class="k">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="c1">#tmp_file=${ss_dir}/${time}</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="nv">tmp_file</span><span class="o">=</span><span class="s2">&quot;/home/deck/.var/app/net.ankiweb.Anki/</span><span class="nv">$time</span><span class="s2">&quot;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>spectacle<span class="w"> </span>--background<span class="w"> </span>--activewindow<span class="w"> </span>--nonotify<span class="w"> </span>--output<span class="w"> </span><span class="nv">$tmp_file</span>.jpg
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="c1">### import to anki. Code taken from https://gist.github.com/xythh/96796571baa850783a0b49f4d325e5b2 with minor edits</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="nv">ankiConnectPort</span><span class="o">=</span><span class="s2">&quot;8765&quot;</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="nv">pictureField</span><span class="o">=</span><span class="s2">&quot;Picture&quot;</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="c1"># This gets your notes marked as new and returns the newest one.</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="nv">newestNoteId</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>localhost:<span class="nv">$ankiConnectPort</span><span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;action&quot;: &quot;findNotes&quot;, &quot;version&quot;: 6, &quot;params&quot;: { &quot;query&quot;: &quot;is:new&quot;}}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.result[-1]&#39;</span><span class="k">)</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="c1"># if anki connect is running it will return your latest note id, and the following code will run, if anki connect is not running a notification pops up.</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$newestNoteId</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">    </span>curl<span class="w"> </span>-s<span class="w"> </span>localhost:<span class="nv">$ankiConnectPort</span><span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="s1">        &quot;action&quot;: &quot;updateNoteFields&quot;,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="s1">        &quot;version&quot;: 6,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="s1">        &quot;params&quot;: {</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="s1">            &quot;note&quot;: {</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="s1">                &quot;id&quot;: &#39;</span><span class="s2">&quot;</span><span class="nv">$newestNoteId</span><span class="s2">&quot;</span><span class="s1">&#39;,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="s1">                &quot;fields&quot;: {</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="s1">                    &quot;&#39;</span><span class="nv">$pictureField</span><span class="s1">&#39;&quot;: &quot;&quot;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="s1">                },</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="s1">                &quot;picture&quot;: [{</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="s1">                    &quot;path&quot;: &quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$tmp_file</span><span class="s2">&quot;</span><span class="s1">&#39;.jpg&quot;,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="s1">                    &quot;filename&quot;: &quot;paste-&#39;</span><span class="s2">&quot;</span><span class="nv">$time</span><span class="s2">&quot;</span><span class="s1">&#39;.jpg&quot;,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="s1">                    &quot;fields&quot;: [</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="s1">                        &quot;&#39;</span><span class="nv">$pictureField</span><span class="s1">&#39;&quot;</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="s1">                    ]</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="s1">                }]</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="s1">            }</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="s1">        }</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="s1">    }&#39;</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="w">    </span>notify-send<span class="w"> </span><span class="s2">&quot;Saving screenshot to Anki...&quot;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="k">else</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="w">    </span>notify-send<span class="w"> </span><span class="s2">&quot;Ankiconnect is not running, unable to save screenshot to Anki card.&quot;</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="k">fi</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>rm<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$tmp_file</span><span class="s2">.jpg&quot;</span>
</code></pre></div>
<h2 id="how-to-record-audio-to-anki">How to record audio to Anki</h2>
<p>Save this shell script to your Deck, keep it somewhere you'll remember. 
Calling this script will start recording audio, calling it again will stop recording and save the audio clip to the latest Anki note.
Likewise, with thanks to Xythh for 99% of the code.</p>
<details class="note">
<summary>record_audio.sh</summary>
</details>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="ch">#!/bin/sh</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="c1"># Version 1.2</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="c1"># script taken from https://gist.github.com/xythh/aab65a301a001ef6107cd54a360d4453 with minor edits</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="c1"># shoutout to https://gist.github.com/Cephian/f849e326e3522be9a4386b60b85f2f23 for the original script,</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="c1"># https://github.com/xythh/ added the ankiConnect functionality</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="c1"># # toggle record computer audio (run once to start, run again to stop)</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="c1"># # dependencies: ffmpeg, pulseaudio, curl</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="c1"># # for Steam deck: use python (or perl) instead of bc (since bc is not installed by default)</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="c1">#</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="c1"># # where recording gets saved, gets deleted after being imported to anki</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="nv">DIRECTORY</span><span class="o">=</span><span class="s2">&quot;/home/deck/.var/app/net.ankiweb.Anki/&quot;</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="nv">FORMAT</span><span class="o">=</span><span class="s2">&quot;mp3&quot;</span><span class="w"> </span><span class="c1"># ogg or mp3</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="c1"># cut file since it glitches a bit at the end sometimes</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="c1">#CUT_DURATION=&quot;0.1&quot;</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="nv">CUT_DURATION</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="c1">#port used by ankiconnect</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="nv">ankiConnectPort</span><span class="o">=</span><span class="s2">&quot;8765&quot;</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="c1"># gets the newest created card, so make sure to create the card first with yomichan</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="nv">newestNoteId</span><span class="o">=</span><span class="k">$(</span>curl<span class="w"> </span>-s<span class="w"> </span>localhost:<span class="nv">$ankiConnectPort</span><span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;{&quot;action&quot;: &quot;findNotes&quot;, &quot;version&quot;: 6, &quot;params&quot;: { &quot;query&quot;: &quot;is:new&quot;}}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.result[-1]&#39;</span><span class="k">)</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="c1">#Audio field name</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="nv">audioFieldName</span><span class="o">=</span><span class="s2">&quot;SentenceAudio&quot;</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="c1">#if there is no newest note, you either have a complete empty anki or ankiconnect isn&#39;t running</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$newestNoteId</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">  </span>notify-send<span class="w"> </span><span class="s2">&quot;anki connect not found&quot;</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">  </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="k">fi</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="k">if</span><span class="w"> </span>pgrep<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;parec&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">  </span>pkill<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;parec&quot;</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="k">else</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="w">  </span><span class="nv">time</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%s<span class="k">)</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="w">  </span><span class="nv">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$DIRECTORY</span><span class="s2">/</span><span class="nv">$time</span><span class="s2">&quot;</span>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="w">  </span><span class="nv">wav_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$name</span><span class="s2">.wav&quot;</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="w">  </span><span class="nv">out_file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$name</span><span class="s2">.</span><span class="nv">$FORMAT</span><span class="s2">&quot;</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="o">[</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DIRECTORY</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="w">      </span>mkdir<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$DIRECTORY</span><span class="s2">&quot;</span>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="w">  </span><span class="k">fi</span>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="w">  </span>notify-send<span class="w"> </span>-t<span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="s2">&quot;Audio recording started&quot;</span>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a><span class="w">  </span><span class="c1">#timeout 1m arecord -t wav -f cd &quot;$wav_file&quot;</span>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>
<a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a><span class="w">  </span><span class="c1"># just grabs last running source... may not always work if your pulseaudio setup is complicated</span>
<a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>timeout<span class="w"> </span>1m<span class="w"> </span>parec<span class="w"> </span>-d<span class="s2">&quot;</span><span class="k">$(</span>pactl<span class="w"> </span>list<span class="w"> </span>sinks<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-B1<span class="w"> </span><span class="s1">&#39;State: RUNNING&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-nE<span class="w"> </span><span class="s1">&#39;s/Sink #(.*)/\1/p&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>--file-format<span class="o">=</span>wav<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$wav_file</span><span class="s2">&quot;</span><span class="p">;</span>
<a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a><span class="w">  </span><span class="k">then</span>
<a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a>
<a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a><span class="w">      </span>notify-send<span class="w"> </span><span class="s2">&quot;Error recording &quot;</span><span class="w"> </span><span class="s2">&quot;most likely no audio playing&quot;</span>
<a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a><span class="w">      </span>rm<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$wav_file</span><span class="s2">&quot;</span>
<a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a><span class="w">      </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a><span class="w">  </span><span class="k">fi</span>
<a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a>
<a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a><span class="w">  </span><span class="nv">input_duration</span><span class="o">=</span><span class="k">$(</span>ffprobe<span class="w"> </span>-v<span class="w"> </span>error<span class="w"> </span>-select_streams<span class="w"> </span>a:0<span class="w"> </span>-show_entries<span class="w"> </span><span class="nv">stream</span><span class="o">=</span>duration<span class="w"> </span>-of<span class="w"> </span><span class="nv">default</span><span class="o">=</span><span class="nv">noprint_wrappers</span><span class="o">=</span><span class="m">1</span>:nokey<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$wav_file</span><span class="s2">&quot;</span><span class="k">)</span>
<a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a><span class="c1">#     output_duration=$(echo &quot;$input_duration&quot;-&quot;$CUT_DURATION&quot; | bc)</span>
<a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a><span class="w">  </span><span class="nv">output_duration</span><span class="o">=</span><span class="sb">`</span>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;print(</span><span class="nv">$input_duration</span><span class="s2">-</span><span class="nv">$CUT_DURATION</span><span class="s2">)&quot;</span><span class="sb">`</span>
<a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a>
<a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a><span class="w">  </span><span class="c1"># encode file and delete OG</span>
<a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$FORMAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ogg&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a><span class="w">      </span>ffmpeg<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$wav_file</span><span class="s2">&quot;</span><span class="w"> </span>-vn<span class="w"> </span>-codec:a<span class="w"> </span>libvorbis<span class="w"> </span>-b:a<span class="w"> </span>64k<span class="w"> </span>-t<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output_duration</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$out_file</span><span class="s2">&quot;</span>
<a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a><span class="w">  </span><span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$FORMAT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mp3&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a><span class="w">      </span>ffmpeg<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$wav_file</span><span class="s2">&quot;</span><span class="w"> </span>-vn<span class="w"> </span>-codec:a<span class="w"> </span>libmp3lame<span class="w"> </span>-qscale:a<span class="w"> </span><span class="m">1</span><span class="w"> </span>-t<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$output_duration</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$out_file</span><span class="s2">&quot;</span>
<a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a><span class="w">  </span><span class="k">else</span>
<a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a><span class="w">      </span>notify-send<span class="w"> </span><span class="s2">&quot;Record Error&quot;</span><span class="w"> </span><span class="s2">&quot;Unknown format </span><span class="nv">$FORMAT</span><span class="s2">&quot;</span>
<a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a><span class="w">  </span><span class="k">fi</span>
<a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a><span class="w">  </span>rm<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$wav_file</span><span class="s2">&quot;</span>
<a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a>
<a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a><span class="c1"># Update newest note with recorded audio</span>
<a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a>curl<span class="w"> </span>-s<span class="w"> </span>localhost:<span class="nv">$ankiConnectPort</span><span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a><span class="s1">    &quot;action&quot;: &quot;updateNoteFields&quot;,</span>
<a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a><span class="s1">    &quot;version&quot;: 6,</span>
<a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a><span class="s1">    &quot;params&quot;: {</span>
<a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a><span class="s1">        &quot;note&quot;: {</span>
<a id="__codelineno-1-73" name="__codelineno-1-73" href="#__codelineno-1-73"></a><span class="s1">            &quot;id&quot;: &#39;</span><span class="s2">&quot;</span><span class="nv">$newestNoteId</span><span class="s2">&quot;</span><span class="s1">&#39;,</span>
<a id="__codelineno-1-74" name="__codelineno-1-74" href="#__codelineno-1-74"></a><span class="s1">      &quot;fields&quot;: {</span>
<a id="__codelineno-1-75" name="__codelineno-1-75" href="#__codelineno-1-75"></a><span class="s1">                &quot;&#39;</span><span class="nv">$audioFieldName</span><span class="s1">&#39;&quot;: &quot;&quot;</span>
<a id="__codelineno-1-76" name="__codelineno-1-76" href="#__codelineno-1-76"></a><span class="s1">            },</span>
<a id="__codelineno-1-77" name="__codelineno-1-77" href="#__codelineno-1-77"></a><span class="s1">            &quot;audio&quot;: [{</span>
<a id="__codelineno-1-78" name="__codelineno-1-78" href="#__codelineno-1-78"></a><span class="s1">                &quot;path&quot;: &quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$out_file</span><span class="s2">&quot;</span><span class="s1">&#39;&quot;,</span>
<a id="__codelineno-1-79" name="__codelineno-1-79" href="#__codelineno-1-79"></a><span class="s1">                &quot;filename&quot;: &quot;&#39;</span><span class="s2">&quot;</span><span class="nv">$time</span><span class="s2">&quot;</span><span class="s1">&#39;.&#39;</span><span class="nv">$FORMAT</span><span class="s1">&#39;&quot;,</span>
<a id="__codelineno-1-80" name="__codelineno-1-80" href="#__codelineno-1-80"></a><span class="s1">                &quot;fields&quot;: [</span>
<a id="__codelineno-1-81" name="__codelineno-1-81" href="#__codelineno-1-81"></a><span class="s1">                    &quot;&#39;</span><span class="nv">$audioFieldName</span><span class="s1">&#39;&quot;</span>
<a id="__codelineno-1-82" name="__codelineno-1-82" href="#__codelineno-1-82"></a><span class="s1">                ]</span>
<a id="__codelineno-1-83" name="__codelineno-1-83" href="#__codelineno-1-83"></a><span class="s1">            }]</span>
<a id="__codelineno-1-84" name="__codelineno-1-84" href="#__codelineno-1-84"></a><span class="s1">        }</span>
<a id="__codelineno-1-85" name="__codelineno-1-85" href="#__codelineno-1-85"></a><span class="s1">    }</span>
<a id="__codelineno-1-86" name="__codelineno-1-86" href="#__codelineno-1-86"></a><span class="s1">}&#39;</span>
<a id="__codelineno-1-87" name="__codelineno-1-87" href="#__codelineno-1-87"></a><span class="c1"># opens changed note, comment if you don&#39;t want it.</span>
<a id="__codelineno-1-88" name="__codelineno-1-88" href="#__codelineno-1-88"></a><span class="c1"># curl -s localhost:$ankiConnectPort -X POST -d &#39;{</span>
<a id="__codelineno-1-89" name="__codelineno-1-89" href="#__codelineno-1-89"></a><span class="c1">#     &quot;action&quot;: &quot;guiBrowse&quot;,</span>
<a id="__codelineno-1-90" name="__codelineno-1-90" href="#__codelineno-1-90"></a><span class="c1">#     &quot;version&quot;: 6,</span>
<a id="__codelineno-1-91" name="__codelineno-1-91" href="#__codelineno-1-91"></a><span class="c1">#     &quot;params&quot;: {</span>
<a id="__codelineno-1-92" name="__codelineno-1-92" href="#__codelineno-1-92"></a><span class="c1">#         &quot;query&quot;: &quot;nid:&#39;&quot;$newestNoteId&quot;&#39;&quot;</span>
<a id="__codelineno-1-93" name="__codelineno-1-93" href="#__codelineno-1-93"></a><span class="c1">#     }</span>
<a id="__codelineno-1-94" name="__codelineno-1-94" href="#__codelineno-1-94"></a><span class="c1"># }&#39;</span>
<a id="__codelineno-1-95" name="__codelineno-1-95" href="#__codelineno-1-95"></a><span class="w">  </span>notify-send<span class="w"> </span>-t<span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="s2">&quot;Audio recording copied&quot;</span>
<a id="__codelineno-1-96" name="__codelineno-1-96" href="#__codelineno-1-96"></a><span class="w">  </span>rm<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$out_file</span><span class="s2">&quot;</span>
<a id="__codelineno-1-97" name="__codelineno-1-97" href="#__codelineno-1-97"></a><span class="k">fi</span>
</code></pre></div>
<h2 id="adding-keyboard-shortcuts-to-call-the-screenshot-and-record-audio-scripts">Adding keyboard shortcuts to call the screenshot and record audio scripts</h2>
<ol>
<li>Open the keyboard shortcut settings from the start menu. (easiest way is to type to find it)
   <img alt="keyboard shortcuts setting" src="../../img/menu-keyboard-shortcuts.png" title="Keyboard Shortcuts" /></li>
<li>Click on <code>Custom Shortcuts</code> on the left.</li>
<li>Click <code>Edit</code>-&gt; <code>New</code>-&gt; <code>Global Shortcut</code> -&gt; <code>Command/URL</code></li>
<li>Rename it, eg. to "Anki screenshot"</li>
<li>Edit the trigger to a shortcut key combo (you'll need to map this to a controller button later). I use Alt+Shift+C for screenshot and Alt+Shift+A for audio recording, but this is totally up to you, just pick something unlikely to clash with anything else in-game or with other software.
<img alt="shortcut trigger" src="../../img/add-custom-shortcut-trigger.png" title="Shortcut trigger" /></li>
<li>Edit the action to the screenshot script you saved earlier. Put the path of the script in. (Reminder: if you move the file, you'll have to edit this shortcut.)
<img alt="shortcut action" src="../../img/add-custom-shortcut-action.png" title="Shortcut action" /></li>
<li>Repeat steps #3-6 for the script to record audio.</li>
</ol>
<h2 id="mapping-the-shortcuts-and-other-actions-to-controller-buttons">Mapping the shortcuts and other actions to controller buttons</h2>
<p>You'll want to map controller buttons to actions we need when mining. 
If you're launching the game through Steam, you'll need to set up both the desktop and also game-specific configs, as the latter will apply when the game is in focus.</p>
<p>Desktop controller config:
- Alt + tab
- mine word (Alt+E)
- replay Yomichan audio</p>
<p>Game controller config - you'll need to do this for every game. Map the shortcut triggers you set up earlier:
- save screenshot to card 
- start/stop recording audio and save to card</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../OCR/" class="btn btn-neutral float-left" title="Using OCR"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../controller/" class="btn btn-neutral float-right" title="Controller Mapping">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../OCR/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../controller/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
